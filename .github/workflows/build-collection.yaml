name: Build Ansible Collection

on:
  push:
    branches:
      - "**"
    tags: [v*]

env:
  ANSIBLE_COLLECTION_VERSION: ${{ github.ref_name }}

jobs:
  echo:
    runs-on: ubuntu-latest
    steps:
      - name: Echo collection version
        run: echo "Collection version is ${{ env.ANSIBLE_COLLECTION_VERSION }}"

  ansible-build-collection:
    uses: redhat-consulting-services/github-actions-collection/.github/workflows/ansible-galaxy.yaml@main
    with:
      path: .
      push: false
      galaxy_token: ${{ secrets.ANSIBLE_GALAXY_TOKEN }}
      # TODO: change this to the git tag version
      version: "0.1.0"

  build-execution-environment:
    needs: ansible-build-collection
    uses: ./.github/workflows/build-ee.yaml@main
