---
apiVersion: v1
kind: Secret
metadata:
  name: {{ repository.name }}
  namespace: "{{ argocd.instance.namespace }}"
  labels:
    argocd.argoproj.io/secret-type: repository
  annotations:
    managed-by: argocd.argoproj.io
type: Opaque
stringData:
  type: {{ repository.type }}
  url: {{ repository.url }}
{% if repository.authentication is defined %}
{% if repository.authentication.username != "" or argocd.authentication.password != "" %}
  username: "{{ repository.authentication.username }}"
  password: "{{ repository.authentication.password }}"
{% endif %}
{% endif %}
{% if repository.type == "helm" and repository.enableOCI %}
  enableOCI: "{{ repository.enableOCI }}"
{% endif %}
{% if repository.insecure is defined %}
  forceHttpBasicAuth: {{ repository.insecure | default(false) }}
{% endif %}
{% if repository.forceHttpBasicAuth is defined %}
  forceHttpBasicAuth: {{ repository.forceHttpBasicAuth | default(false) }}
{% endif %}
